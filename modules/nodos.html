<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link async rel="stylesheet" href="../css/site.css">
    <title>Nodos | CSModules</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="shortcut icon" href="http://explorationlab.projectioncore.com/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
</head>
<body>    
    <header class="header" style="z-index: 100;">
        <h1>CSModules - Nodos</h1> <span id="current-user">user</span>
    </header>
    <div id="mySidebar" class="sidebar" onmouseover="toggleSidebar()" onmouseout="toggleSidebar()">
        <a href="./index.html">
            <i class="material-icons item">info</i><span class="icon-text">Info</span>
        </a>
        <a href="./nodos.html">
            <i class="material-icons item">folder_open</i><span class="icon-text">Nodos</span>
        </a>
    </div>
    <div id="main">
        <h2><i class="material-icons">label</i> Nodos</h2>
        <h3><span id="node-name">Nombre del nodo</span></h3>
        <div class="node-content">
            <div id="load" class="load">
                <svg viewBox="0 0 32 32" width="32" height="32">
                    <circle id="spinner" cx="16" cy="16" r="14" fill="none"></circle>
                </svg>
            </div>
            <table id="node-children" >
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Contenido</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <script type="text/javascript" src="../js/modules/site.js"></script>
    <script type="text/javascript" src="../js/core/__OTCommands.js"></script>
    <script type="text/javascript" src="../js/core/__OTRequest.js"></script>
    <script type="text/javascript" src="../js/core/model/_mOTConfig.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
        let complete = infoNode(2000);
        

        $('#node-children')
        .addClass( 'nowrap' )
        .dataTable( {
            processing: true,
            responsive: true,
            columnDefs: [
            { targets: [-1, -3], className: 'dt-body-right' }
            ]
        } );
        async function infoNode(idNode){
            document.querySelector('#load').style = "display: block;"
            let node = await _getNode(idNode);
            let infoNode =  node.results.data;
            document.querySelector('#node-name').innerHTML = infoNode.properties.name
            let children = await _getChildren(idNode);
            emptyTableNode();
            const childs = children.data.length;
            
            for (let i = 0; i < childs; i++) {
                let tableRef = document.getElementById('node-children').getElementsByTagName('tbody')[0];
                let newRow   = tableRef.insertRow();
                let newCell0  = newRow.insertCell(0);
                let nameNode  = document.createTextNode(children.data[i].name);
                newCell0.appendChild(nameNode);
                newCell0.setAttribute('onclick', `infoNode(${children.data[i].id})` );
                newCell0.style.cursor='pointer';
                newCell0.classList.add("item-node-list");
                let newCell1  = newRow.insertCell(1);
                let typeNode  = document.createTextNode(children.data[i].type_name);
                newCell1.appendChild(typeNode);
                let newCell2  = newRow.insertCell(2);
                let contNode  = document.createTextNode(children.data[i].size_formatted);
                newCell2.appendChild(contNode);
                let newCell3  = newRow.insertCell(3);
            }
            document.querySelector('#load').style = "display: none;"
            return true;
        }
    </script>
</body>
</html>